<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Futures Volatility (Top 100)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f4f6f9; padding: 20px; }
        .container { max-width: 1200px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .symbol-badge { background-color: #e9ecef; color: #495057; padding: 2px 6px; border-radius: 4px; font-size: 0.85em; font-weight: bold; margin-left: 5px; }
        .text-green { color: #198754; font-weight: bold; }
        .text-red { color: #dc3545; font-weight: bold; }
        .coin-name-th { font-size: 1.1em; font-weight: bold; color: #000; }
        .coin-name-en { font-size: 0.85em; color: #6c757d; }
    </style>
</head>
<body>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <!-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏õ‡πá‡∏ô 100 -->
        <h2>üöÄ 100 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç Futures ‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô (‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢)</h2>
        <button onclick="fetchData()" class="btn btn-primary">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
    
    <div id="loading" class="text-center my-4">
        <div class="spinner-border text-primary" role="status"></div>
        <br><span id="statusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered d-none" id="cryptoTable">
            <thead class="table-dark text-center">
                <tr>
                    <th style="width: 30%;">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç (TH/EN)</th>
                    <th>‡∏£‡∏≤‡∏Ñ‡∏≤ (USD)</th>
                    <th>1 ‡∏ä‡∏°. %</th>
                    <th>24 ‡∏ä‡∏°. %</th>
                    <th>7 ‡∏ß‡∏±‡∏ô %</th>
                    <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ï‡∏•‡∏≤‡∏î (USD)</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API KEY ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ---
    const GOOGLE_API_KEY = "AIzaSyAnjH33eZERDbzQWDQ_I_sQHF-S8Fnfnxc";

    const manualDict = {
        "Stable": "‡∏™‡πÄ‡∏ï‡πÄ‡∏ö‡∏¥‡∏•",
        "Bitcoin": "‡∏ö‡∏¥‡∏ï‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå",
        "Ethereum": "‡∏≠‡∏µ‡πÄ‡∏ò‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏°",
        "Tether": "‡πÄ‡∏ó‡πÄ‡∏ò‡∏≠‡∏£‡πå",
        "BNB": "‡∏ö‡∏µ‡πÄ‡∏≠‡πá‡∏ô‡∏ö‡∏µ",
        "Solana": "‡πÇ‡∏ã‡∏•‡∏≤‡∏ô‡πà‡∏≤",
        "XRP": "‡πÄ‡∏≠‡πá‡∏Å‡∏ã‡πå‡∏≠‡∏≤‡∏£‡πå‡∏û‡∏µ",
        "Dogecoin": "‡πÇ‡∏î‡∏à‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå",
        "Cardano": "‡∏Ñ‡∏≤‡∏£‡πå‡∏î‡∏≤‡πÇ‡∏ô‡πà",
        "Pepe": "‡πÄ‡∏õ‡πÄ‡∏õ‡πâ",
        "Chiliz": "‡∏ä‡∏¥‡∏•‡∏•‡∏¥‡∏ã",
        "Pippin": "‡∏û‡∏¥‡∏û‡∏û‡∏¥‡∏ô",
        "STABLE": "‡∏™‡πÄ‡∏ï‡πÄ‡∏ö‡∏¥‡∏•", 
        "BTC": "‡∏ö‡∏¥‡∏ï‡∏Ñ‡∏≠‡∏¢‡∏ô‡πå",
        "ETH": "‡∏≠‡∏µ‡πÄ‡∏ò‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏°",
        "SOL": "‡πÇ‡∏ã‡∏•‡∏≤‡∏ô‡πà‡∏≤",
        "CHZ": "‡∏ä‡∏¥‡∏•‡∏•‡∏¥‡∏ã",
        "PIPPIN": "‡∏û‡∏¥‡∏û‡∏û‡∏¥‡∏ô"
    };

    const fmt = (num) => num ? num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '-';
    const fmtPct = (num) => {
        if (num === null || num === undefined) return '-';
        return `<span class="${num >= 0 ? 'text-green' : 'text-red'}">${num.toFixed(2)}%</span>`;
    };

    function getThaiName(name, symbol) {
        const cleanName = name ? name.trim() : "";
        const cleanSymbol = symbol ? symbol.toUpperCase().trim() : "";
        if (manualDict[cleanName]) return manualDict[cleanName];
        if (manualDict[cleanSymbol]) return manualDict[cleanSymbol];
        return null;
    }

    async function translateWithGemini(coinNames) {
        const namesToTranslate = coinNames.filter(name => !getThaiName(name, "")); 
        
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏• ‡∏Å‡πá‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
        if (namesToTranslate.length === 0) return {};

        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GOOGLE_API_KEY}`;
        const prompt = `
        Translate these Cryptocurrency names into Thai (Thai script only).
        Return valid JSON: {"EnglishName": "ThaiName"}.
        List: ${namesToTranslate.join(", ")}
        `;

        try {
            const response = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { response_mime_type: "application/json" }
                })
            });
            const data = await response.json();
            if (data.candidates && data.candidates[0].content) {
                return JSON.parse(data.candidates[0].content.parts[0].text);
            }
        } catch (error) {
            console.error("AI Error:", error);
        }
        return {};
    }

    async function fetchData() {
        const loadingDiv = document.getElementById('loading');
        const statusText = document.getElementById('statusText');
        const table = document.getElementById('cryptoTable');
        const tbody = document.getElementById('tableBody');

        loadingDiv.style.display = 'block';
        table.classList.add('d-none');
        tbody.innerHTML = '';
        
        try {
            statusText.innerText = "1/3 ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Binance Futures...";
            const binanceRes = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');
            const binanceData = await binanceRes.json();
            const futuresSymbols = new Set(binanceData.symbols.filter(s => s.status === 'TRADING' && s.quoteAsset === 'USDT').map(s => s.baseAsset.toUpperCase()));

            statusText.innerText = "2/3 ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏≤‡∏Å CoinGecko...";
            // CoinGecko API ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏°‡∏≤ 250 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (per_page=250) ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 100 ‡∏ï‡∏±‡∏ß‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
            const cgRes = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=1&sparkline=false&price_change_percentage=1h,24h,7d');
            const cgData = await cgRes.json();

            let filteredData = cgData.filter(coin => futuresSymbols.has(coin.symbol.toUpperCase()));
            filteredData.forEach(coin => coin.abs_7d = Math.abs(coin.price_change_percentage_7d_in_currency || 0));
            filteredData.sort((a, b) => b.abs_7d - a.abs_7d);
            
            // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô slice ‡∏à‡∏≤‡∏Å 20 ‡πÄ‡∏õ‡πá‡∏ô 100
            const top100 = filteredData.slice(0, 100);

            statusText.innerText = "3/3 ‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (Manual + AI)...";
            // ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ 100 ‡∏ï‡∏±‡∏ß‡πÑ‡∏õ‡πÅ‡∏õ‡∏• (AI ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ô‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢)
            const coinNames = top100.map(c => c.name);
            const aiTranslatedMap = await translateWithGemini(coinNames);

            top100.forEach(coin => {
                const thaiName = getThaiName(coin.name, coin.symbol) || 
                                 aiTranslatedMap[coin.name] || 
                                 coin.name;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="text-start align-middle">
                        <div class="d-flex align-items-center">
                            <img src="${coin.image}" width="24" height="24" class="me-2 rounded-circle" alt="">
                            <div>
                                <div class="coin-name-th">${thaiName}</div>
                                <div class="coin-name-en">
                                    ${coin.name} 
                                    <span class="symbol-badge">${coin.symbol.toUpperCase()}</span>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="text-end align-middle">${fmt(coin.current_price)}</td>
                    <td class="text-end align-middle">${fmtPct(coin.price_change_percentage_1h_in_currency)}</td>
                    <td class="text-end align-middle">${fmtPct(coin.price_change_percentage_24h_in_currency)}</td>
                    <td class="text-end align-middle">${fmtPct(coin.price_change_percentage_7d_in_currency)}</td>
                    <td class="text-end align-middle">${fmt(coin.market_cap)}</td>
                `;
                tbody.appendChild(tr);
            });

            loadingDiv.style.display = 'none';
            table.classList.remove('d-none');

        } catch (error) {
            console.error(error);
            loadingDiv.innerHTML = `<span class="text-danger">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</span>`;
        }
    }

    fetchData();
</script>

</body>
</html>